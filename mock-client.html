<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <script src="https://cdn.socket.io/socket.io-1.3.7.js"></script>
</head>

<body>
  <script>

    window.join = function (userId) {
      const siteId = location.search.match(/id=(\d+)/)[1]
      const socket = io()

      socket.on('connect', function () {
        socket.on('message', function (data) {
            console.log('got message', data);
        })

        socket.on('enter', function(data) {
            console.log(`${data.userId} has joined`)
        })

        socket.emit('join', {
            userId,
            siteId
        })
      })

      window.send = function (message) {
        socket.emit('message', {
            type: 'bullshit',
            siteId,
            userId,
            message
        });
      };
    }

  </script>
</body>
</html>
